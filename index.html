<!DOCTYPE html>
<html>

<head>
    <title>Album Arcade</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
        }

        .apple-blur {
            background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(20px);
        }

        .hover-scale {
            transition: transform 0.2s;
        }

        .hover-scale:hover {
            transform: scale(1.02);
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const MusicLibrary = () => {
            // State definitions
            const [albums, setAlbums] = React.useState(() => {
                const saved = localStorage.getItem('musicLibrary');
                return saved ? JSON.parse(saved) : [];
            });
            const [newAlbum, setNewAlbum] = React.useState('');
            const [newArtist, setNewArtist] = React.useState('');
            const [selectedAlbum, setSelectedAlbum] = React.useState(null);
            const [showUpload, setShowUpload] = React.useState(false);
            const [showLibrary, setShowLibrary] = React.useState(true);
            const [filterText, setFilterText] = React.useState('');
            const [yearFilter, setYearFilter] = React.useState('');
            const [genreFilter, setGenreFilter] = React.useState('');

            // Function definitions
            const addAlbum = () => {
                if (newAlbum && newArtist) {
                    setAlbums(prev => [...prev, {
                        album: newAlbum,
                        artist: newArtist,
                        year: 'Unknown',
                        genre: 'Unknown',
                        listens: 0,
                        skips: 0
                    }]);
                    setNewAlbum('');
                    setNewArtist('');
                }
            };

            const copyToClipboard = () => {
                if (selectedAlbum) {
                    navigator.clipboard.writeText(`${selectedAlbum.album} ${selectedAlbum.artist}`);
                }
            };

            const pickRandomAlbum = () => {
                if (filteredAlbums.length > 0) {
                    const randomIndex = Math.floor(Math.random() * filteredAlbums.length);
                    setSelectedAlbum(filteredAlbums[randomIndex]);
                }
            };

            const removeAlbum = (index) => {
                setAlbums(albums.filter((_, i) => i !== index));
            };

            const handleListen = () => {
                if (selectedAlbum) {
                    setAlbums(albums.map(album =>
                        album.album === selectedAlbum.album && album.artist === selectedAlbum.artist
                            ? { ...album, listens: (album.listens || 0) + 1 }
                            : album
                    ));
                    setSelectedAlbum(null);
                }
            };

            const handleSkip = () => {
                if (selectedAlbum) {
                    setAlbums(albums.map(album =>
                        album.album === selectedAlbum.album && album.artist === selectedAlbum.artist
                            ? { ...album, skips: (album.skips || 0) + 1 }
                            : album
                    ));
                    setSelectedAlbum(null);
                }
            };

            // File upload handler with genre and year
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const parser = new DOMParser();
                        const xml = parser.parseFromString(e.target.result, "text/xml");
                        const tracks = xml.getElementsByTagName("dict")[0].getElementsByTagName("dict");
                        const newAlbums = new Set();

                        for (let track of tracks) {
                            const keys = track.getElementsByTagName("key");
                            let albumName = "";
                            let artistName = "";
                            let year = "";
                            let genre = "";

                            for (let i = 0; i < keys.length; i++) {
                                switch (keys[i].textContent) {
                                    case "Album":
                                        albumName = keys[i].nextElementSibling.textContent;
                                        break;
                                    case "Artist":
                                        artistName = keys[i].nextElementSibling.textContent;
                                        break;
                                    case "Year":
                                        year = keys[i].nextElementSibling.textContent;
                                        break;
                                    case "Genre":
                                        genre = keys[i].nextElementSibling.textContent;
                                        break;
                                }
                            }

                            if (albumName && artistName) {
                                newAlbums.add(JSON.stringify({
                                    album: albumName,
                                    artist: artistName,
                                    year: year || 'Unknown',
                                    genre: genre || 'Unknown',
                                    listens: 0,
                                    skips: 0
                                }));
                            }
                        }

                        const albumsArray = Array.from(newAlbums).map(item => JSON.parse(item));
                        setAlbums(prevAlbums => {
                            const combined = [...prevAlbums, ...albumsArray];
                            const unique = Array.from(new Set(combined.map(a => JSON.stringify(a))))
                                .map(item => JSON.parse(item));
                            return unique;
                        });

                        alert(`Successfully imported ${albumsArray.length} albums!`);
                    };
                    reader.readAsText(file);
                }
            };

            // Filters
            const years = React.useMemo(() =>
                Array.from(new Set(albums.map(a => a.year))).sort().filter(Boolean),
                [albums]
            );

            const genres = React.useMemo(() =>
                Array.from(new Set(albums.map(a => a.genre))).sort().filter(Boolean),
                [albums]
            );

            const filteredAlbums = React.useMemo(() => {
                return albums.filter(album => {
                    const matchesSearch = !filterText ||
                        album.album.toLowerCase().includes(filterText.toLowerCase()) ||
                        album.artist.toLowerCase().includes(filterText.toLowerCase());
                    const matchesYear = !yearFilter || album.year === yearFilter;
                    const matchesGenre = !genreFilter || album.genre === genreFilter;
                    return matchesSearch && matchesYear && matchesGenre;
                });
            }, [albums, filterText, yearFilter, genreFilter]);

            // Save to localStorage
            React.useEffect(() => {
                localStorage.setItem('musicLibrary', JSON.stringify(albums));
            }, [albums]);

            return (
                <div className="min-h-screen bg-black p-4">
                    <div className="max-w-7xl mx-auto space-y-4">
                        {/* Header */}
                        <div className="apple-blur rounded-lg p-6 flex justify-between items-center">
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-pink-500 to-violet-500 bg-clip-text text-transparent">
                                Album Arcade
                            </h1>
                            <button
                                onClick={() => setShowLibrary(!showLibrary)}
                                className="px-4 py-2 rounded-full bg-white/10 hover:bg-white/20 transition-colors"
                            >
                                {showLibrary ? 'Hide Library' : 'Show Library'}
                            </button>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            {/* Main Controls */}
                            <div className="apple-blur rounded-lg p-6 space-y-6">
                                {/* Filters */}
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="Search..."
                                        value={filterText}
                                        onChange={(e) => setFilterText(e.target.value)}
                                        className="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/10 focus:border-white/20 transition-colors"
                                    />

                                    <div className="flex gap-4">
                                        <select
                                            value={yearFilter}
                                            onChange={(e) => setYearFilter(e.target.value)}
                                            className="flex-1 px-4 py-2 rounded-lg bg-white/10 border border-white/10"
                                        >
                                            <option value="">All Years</option>
                                            {years.map(year => (
                                                <option key={year} value={year}>{year}</option>
                                            ))}
                                        </select>

                                        <select
                                            value={genreFilter}
                                            onChange={(e) => setGenreFilter(e.target.value)}
                                            className="flex-1 px-4 py-2 rounded-lg bg-white/10 border border-white/10"
                                        >
                                            <option value="">All Genres</option>
                                            {genres.map(genre => (
                                                <option key={genre} value={genre}>{genre}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                {/* Random Button */}
                                <button
                                    onClick={pickRandomAlbum}
                                    className="w-full px-6 py-4 rounded-lg bg-gradient-to-r from-pink-500 to-violet-500 hover:opacity-90 font-bold"
                                    disabled={filteredAlbums.length === 0}
                                >
                                    Pick Random Album ({filteredAlbums.length})
                                </button>

                                {/* Selected Album */}
                                {selectedAlbum && (
                                    <div className="bg-white/10 rounded-lg p-6">
                                        <div className="text-center space-y-4">
                                            <div className="flex items-center justify-center gap-2">
                                                <span className="text-gray-400">Now Playing</span>
                                                <button
                                                    onClick={copyToClipboard}
                                                    className="text-gray-400 hover:text-white"
                                                >
                                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                                    </svg>
                                                </button>
                                            </div>
                                            <h3 className="text-2xl font-bold">{selectedAlbum.album}</h3>
                                            <p className="text-gray-400">{selectedAlbum.artist}</p>
                                            <div className="flex gap-4">
                                                <button
                                                    onClick={handleListen}
                                                    className="flex-1 py-3 rounded-lg bg-green-500 hover:bg-green-600"
                                                >
                                                    Listened
                                                </button>
                                                <button
                                                    onClick={handleSkip}
                                                    className="flex-1 py-3 rounded-lg bg-red-500 hover:bg-red-600"
                                                >
                                                    Skip
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* Upload Controls */}
                                <div className="border-t border-white/10 pt-4">
                                    <button
                                        onClick={() => setShowUpload(!showUpload)}
                                        className="text-gray-400 hover:text-white"
                                    >
                                        {showUpload ? 'Hide Upload Options' : 'Show Upload Options'}
                                    </button>

                                    {showUpload && (
                                        <div className="mt-4 p-4 bg-white/5 rounded-lg">
                                            <input
                                                type="file"
                                                accept=".xml"
                                                onChange={handleFileUpload}
                                                className="w-full p-2 mb-4 bg-white/10 rounded border border-white/10"
                                            />
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    placeholder="Album name"
                                                    value={newAlbum}
                                                    onChange={(e) => setNewAlbum(e.target.value)}
                                                    className="flex-1 px-4 py-2 bg-white/10 rounded border border-white/10"
                                                />
                                                <input
                                                    type="text"
                                                    placeholder="Artist"
                                                    value={newArtist}
                                                    onChange={(e) => setNewArtist(e.target.value)}
                                                    className="flex-1 px-4 py-2 bg-white/10 rounded border border-white/10"
                                                />
                                                <button
                                                    onClick={addAlbum}
                                                    className="px-4 py-2 rounded bg-white/10 hover:bg-white/20"
                                                >
                                                    Add
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Library */}
                            {showLibrary && (
                                <div className="apple-blur rounded-lg">
                                    <div className="p-4 border-b border-white/10 flex justify-between items-center">
                                        <h2 className="text-xl font-bold">Your Library</h2>
                                        <div className="text-sm text-gray-400">
                                            {filteredAlbums.length} albums
                                        </div>
                                    </div>
                                    <div className="h-[calc(100vh-16rem)] overflow-y-auto">
                                        <div className="p-4 space-y-2">
                                            {filteredAlbums.map((item, index) => (
                                                <div
                                                    key={index}
                                                    className="hover-scale flex justify-between items-start p-3 bg-white/5 rounded-lg hover:bg-white/10 group transition-all"
                                                >
                                                    <div className="flex-1">
                                                        <div className="font-medium">{item.album}</div>
                                                        <div className="text-sm text-gray-400">{item.artist}</div>
                                                        <div className="text-xs text-gray-500">
                                                            {item.year} • {item.genre}
                                                        </div>
                                                        <div className="text-xs text-gray-500 mt-1">
                                                            Plays: {item.listens || 0} | Skips: {item.skips || 0}
                                                        </div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeAlbum(index)}
                                                        className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition-opacity"
                                                    >
                                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MusicLibrary />);
    </script>
</body>

</html>